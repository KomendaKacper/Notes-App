{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Fujitsu\\\\Desktop\\\\Notes-App\\\\secure-notes-react\\\\src\\\\components\\\\Auth\\\\OAuth2RedirectHandler.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { jwtDecode } from 'jwt-decode';\nimport { useMyContext } from \"../../store/ContextApi\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OAuth2RedirectHandler = () => {\n  _s();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    setToken,\n    setIsAdmin\n  } = useMyContext();\n  useEffect(() => {\n    const params = new URLSearchParams(location.search);\n    const token = params.get('token');\n    console.log(\"OAuth2RedirectHandler: Params:\", params.toString());\n    console.log(\"OAuth2RedirectHandler: Token:\", token);\n    if (token) {\n      try {\n        const decodedToken = jwtDecode(token);\n        console.log(\"Decoded Token:\", decodedToken);\n        localStorage.setItem('JWT_TOKEN', token);\n        const user = {\n          username: decodedToken.sub,\n          roles: decodedToken.roles.split(',')\n        };\n        console.log(\"User Object:\", user);\n        localStorage.setItem('USER', JSON.stringify(user));\n\n        // Update context state\n        setToken(token);\n        setIsAdmin(user.roles.includes('ADMIN'));\n\n        // Delay navigation to ensure local storage operations complete\n        setTimeout(() => {\n          console.log(\"Navigating to /notes\");\n          navigate('/notes');\n        }, 100); // 100ms delay\n      } catch (error) {\n        console.error('Token decoding failed:', error);\n        navigate('/login');\n      }\n    } else {\n      console.log(\"Token not found in URL, redirecting to login\");\n      navigate('/login');\n    }\n  }, [location, navigate, setToken, setIsAdmin]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Redirecting...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 10\n  }, this);\n};\n_s(OAuth2RedirectHandler, \"4cTjKi2w+Nrg0BRqY6A3t6f+3YA=\", false, function () {\n  return [useNavigate, useLocation, useMyContext];\n});\n_c = OAuth2RedirectHandler;\nexport default OAuth2RedirectHandler;\nvar _c;\n$RefreshReg$(_c, \"OAuth2RedirectHandler\");","map":{"version":3,"names":["React","useEffect","useLocation","useNavigate","jwtDecode","useMyContext","jsxDEV","_jsxDEV","OAuth2RedirectHandler","_s","navigate","location","setToken","setIsAdmin","params","URLSearchParams","search","token","get","console","log","toString","decodedToken","localStorage","setItem","user","username","sub","roles","split","JSON","stringify","includes","setTimeout","error","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Fujitsu/Desktop/Notes-App/secure-notes-react/src/components/Auth/OAuth2RedirectHandler.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport { useMyContext } from \"../../store/ContextApi\";\r\n\r\nconst OAuth2RedirectHandler = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { setToken, setIsAdmin } = useMyContext();\r\n\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(location.search);\r\n    const token = params.get('token');\r\n    console.log(\"OAuth2RedirectHandler: Params:\", params.toString());\r\n    console.log(\"OAuth2RedirectHandler: Token:\", token);\r\n\r\n    if (token) {\r\n      try {\r\n        const decodedToken = jwtDecode(token);\r\n        console.log(\"Decoded Token:\", decodedToken);\r\n\r\n        localStorage.setItem('JWT_TOKEN', token);\r\n\r\n        const user = {\r\n          username: decodedToken.sub,\r\n          roles: decodedToken.roles.split(','),\r\n        };\r\n        console.log(\"User Object:\", user);\r\n        localStorage.setItem('USER', JSON.stringify(user));\r\n\r\n        // Update context state\r\n        setToken(token);\r\n        setIsAdmin(user.roles.includes('ADMIN'));\r\n\r\n        // Delay navigation to ensure local storage operations complete\r\n        setTimeout(() => {\r\n          console.log(\"Navigating to /notes\");\r\n          navigate('/notes');\r\n        }, 100); // 100ms delay\r\n      } catch (error) {\r\n        console.error('Token decoding failed:', error);\r\n        navigate('/login');\r\n      }\r\n    } else {\r\n      console.log(\"Token not found in URL, redirecting to login\");\r\n      navigate('/login');\r\n    }\r\n  }, [location, navigate, setToken, setIsAdmin]);\r\n\r\n  return <div>Redirecting...</div>;\r\n};\r\n\r\nexport default OAuth2RedirectHandler;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,WAAW,EAAEC,WAAW,QAAQ,kBAAkB;AAC3D,SAASC,SAAS,QAAQ,YAAY;AACtC,SAASC,YAAY,QAAQ,wBAAwB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtD,MAAMC,qBAAqB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClC,MAAMC,QAAQ,GAAGP,WAAW,CAAC,CAAC;EAC9B,MAAMQ,QAAQ,GAAGT,WAAW,CAAC,CAAC;EAC9B,MAAM;IAAEU,QAAQ;IAAEC;EAAW,CAAC,GAAGR,YAAY,CAAC,CAAC;EAE/CJ,SAAS,CAAC,MAAM;IACd,MAAMa,MAAM,GAAG,IAAIC,eAAe,CAACJ,QAAQ,CAACK,MAAM,CAAC;IACnD,MAAMC,KAAK,GAAGH,MAAM,CAACI,GAAG,CAAC,OAAO,CAAC;IACjCC,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEN,MAAM,CAACO,QAAQ,CAAC,CAAC,CAAC;IAChEF,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEH,KAAK,CAAC;IAEnD,IAAIA,KAAK,EAAE;MACT,IAAI;QACF,MAAMK,YAAY,GAAGlB,SAAS,CAACa,KAAK,CAAC;QACrCE,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEE,YAAY,CAAC;QAE3CC,YAAY,CAACC,OAAO,CAAC,WAAW,EAAEP,KAAK,CAAC;QAExC,MAAMQ,IAAI,GAAG;UACXC,QAAQ,EAAEJ,YAAY,CAACK,GAAG;UAC1BC,KAAK,EAAEN,YAAY,CAACM,KAAK,CAACC,KAAK,CAAC,GAAG;QACrC,CAAC;QACDV,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEK,IAAI,CAAC;QACjCF,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEM,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC,CAAC;;QAElD;QACAb,QAAQ,CAACK,KAAK,CAAC;QACfJ,UAAU,CAACY,IAAI,CAACG,KAAK,CAACI,QAAQ,CAAC,OAAO,CAAC,CAAC;;QAExC;QACAC,UAAU,CAAC,MAAM;UACfd,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;UACnCV,QAAQ,CAAC,QAAQ,CAAC;QACpB,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;MACX,CAAC,CAAC,OAAOwB,KAAK,EAAE;QACdf,OAAO,CAACe,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;QAC9CxB,QAAQ,CAAC,QAAQ,CAAC;MACpB;IACF,CAAC,MAAM;MACLS,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;MAC3DV,QAAQ,CAAC,QAAQ,CAAC;IACpB;EACF,CAAC,EAAE,CAACC,QAAQ,EAAED,QAAQ,EAAEE,QAAQ,EAAEC,UAAU,CAAC,CAAC;EAE9C,oBAAON,OAAA;IAAA4B,QAAA,EAAK;EAAc;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAAC;AAClC,CAAC;AAAC9B,EAAA,CA7CID,qBAAqB;EAAA,QACRL,WAAW,EACXD,WAAW,EACKG,YAAY;AAAA;AAAAmC,EAAA,GAHzChC,qBAAqB;AA+C3B,eAAeA,qBAAqB;AAAC,IAAAgC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}